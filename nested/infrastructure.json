{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "deploymentId": {
            "defaultValue": "[resourceGroup().name]",
            "type": "String"
        },
        "location": {
            "defaultValue": "[resourceGroup().location]",
            "minLength": 1,
            "type": "String"
        },
        "sitecoreSKU": {
            "defaultValue": "Extra Small",
            "allowedValues": [
                "Extra Small",
                "Small",
                "Medium",
                "Large",
                "Extra Large"
            ],
            "type": "String",
            "metadata": {
                "description": "Sitecore SKU controls the sizes and service levels of the provisioned resources"
            }
        },
        "sqlServerName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-sql')]",
            "minLength": 1,
            "type": "String"
        },
        "sqlServerLogin": {
            "minLength": 1,
            "type": "String"
        },
        "sqlServerPassword": {
            "minLength": 8,
            "type": "SecureString"
        },
        "sqlServerVersion": {
            "defaultValue": "12.0",
            "minLength": 1,
            "type": "String"
        },
        "sqlDatabaseCollation": {
            "defaultValue": "SQL_Latin1_General_CP1_CI_AS",
            "minLength": 1,
            "type": "String"
        },
        "coreSqlDatabaseName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-core-db')]",
            "minLength": 1,
            "type": "String"
        },
        "masterSqlDatabaseName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-master-db')]",
            "minLength": 1,
            "type": "String"
        },
        "webSqlDatabaseName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-web-db')]",
            "minLength": 1,
            "type": "String"
        },
        "poolsSqlDatabaseName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-pools-db')]",
            "minLength": 1,
            "type": "String"
        },
        "tasksSqlDatabaseName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-tasks-db')]",
            "minLength": 1,
            "type": "String"
        },
        "formsSqlDatabaseName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-forms-db')]",
            "minLength": 1,
            "type": "String"
        },
        "exmMasterSqlDatabaseName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-exmmaster-db')]",
            "minLength": 1,
            "type": "String"
        },
        "deployAzureSearch": {
            "defaultValue": true,
            "type": "Bool"
        },
        "searchServiceName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-as')]",
            "type": "String"
        },
        "searchServiceLocation": {
            "defaultValue": "[parameters('location')]",
            "type": "String"
        },
        "searchServiceReplicaCount": {
            "defaultValue": 1,
            "type": "Int"
        },
        "redisCacheName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-redis')]",
            "minLength": 1,
            "type": "String"
        },
        "useApplicationInsights": {
            "defaultValue": true,
            "type": "Bool"
        },
        "applicationInsightsName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-ai')]",
            "minLength": 1,
            "type": "String"
        },
        "applicationInsightsLocation": {
            "defaultValue": "East US",
            "type": "String"
        },
        "applicationInsightsPricePlan": {
            "defaultValue": "[concat(parameters('deploymentId'), '-ai-pp')]",
            "minLength": 1,
            "type": "String"
        },
        "siHostingPlanName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-si-hp')]",
            "minLength": 1,
            "type": "String"
        },
        "cmHostingPlanName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-cm-hp')]",
            "minLength": 1,
            "type": "String"
        },
        "cdHostingPlanName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-cd-hp')]",
            "minLength": 1,
            "type": "String"
        },
        "prcHostingPlanName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-prc-hp')]",
            "minLength": 1,
            "type": "String"
        },
        "repHostingPlanName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-rep-hp')]",
            "minLength": 1,
            "type": "String"
        },
        "siWebAppName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-si')]",
            "minLength": 1,
            "type": "String"
        },
        "cmWebAppName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-cm')]",
            "minLength": 1,
            "type": "String"
        },
        "cdWebAppName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-cd')]",
            "minLength": 1,
            "type": "String"
        },
        "prcWebAppName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-prc')]",
            "minLength": 1,
            "type": "String"
        },
        "repWebAppName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-rep')]",
            "minLength": 1,
            "type": "String"
        },
        "authCertificateName": {
            "defaultValue": "[concat(parameters('deploymentId'), '-auth')]",
            "minLength": 1,
            "type": "String"
        },
        "authCertificateBlob": {
            "minLength": 1,
            "type": "SecureString"
        },
        "authCertificatePassword": {
            "minLength": 1,
            "type": "SecureString"
        },
        "skuMap": {
            "defaultValue": {
                "Extra Small": {
                    "siHostingPlan": {
                        "SkuName": "S1",
                        "SkuCapacity": 1
                    },
                    "siHostingPlanIsolated": {
                        "SkuName": "I1",
                        "SkuCapacity": 1
                    },
                    "cmHostingPlan": {
                        "SkuName": "S3",
                        "SkuCapacity": 1
                    },
                    "cmHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "cdHostingPlan": {
                        "SkuName": "S2",
                        "SkuCapacity": 1
                    },
                    "cdHostingPlanIsolated": {
                        "SkuName": "I1",
                        "SkuCapacity": 1
                    },
                    "prcHostingPlan": {
                        "SkuName": "S1",
                        "SkuCapacity": 1
                    },
                    "prcHostingPlanIsolated": {
                        "SkuName": "I1",
                        "SkuCapacity": 1
                    },
                    "repHostingPlan": {
                        "SkuName": "S1",
                        "SkuCapacity": 1
                    },
                    "repHostingPlanIsolated": {
                        "SkuName": "I1",
                        "SkuCapacity": 1
                    },
                    "coreSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "masterSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "webSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "poolsSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "tasksSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "formsSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "exmMasterSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "searchService": {
                        "SkuName": "Standard",
                        "Partitions": 1,
                        "Replicas": "[parameters('searchServiceReplicaCount')]"
                    },
                    "redisCache": {
                        "SkuName": "Standard",
                        "SkuFamily": "C",
                        "SkuCapacity": 1
                    },
                    "applicationInsightsPricePlan": {
                        "CurrentBillingFeatures": "Basic",
                        "DataVolumeCap": {
                            "Cap": 0.33
                        }
                    }
                },
                "Small": {
                    "siHostingPlan": {
                        "SkuName": "S1",
                        "SkuCapacity": 1
                    },
                    "siHostingPlanIsolated": {
                        "SkuName": "I1",
                        "SkuCapacity": 1
                    },
                    "cmHostingPlan": {
                        "SkuName": "S3",
                        "SkuCapacity": 1
                    },
                    "cmHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "cdHostingPlan": {
                        "SkuName": "S2",
                        "SkuCapacity": 2
                    },
                    "cdHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "prcHostingPlan": {
                        "SkuName": "S1",
                        "SkuCapacity": 1
                    },
                    "prcHostingPlanIsolated": {
                        "SkuName": "I1",
                        "SkuCapacity": 1
                    },
                    "repHostingPlan": {
                        "SkuName": "S1",
                        "SkuCapacity": 1
                    },
                    "repHostingPlanIsolated": {
                        "SkuName": "I1",
                        "SkuCapacity": 1
                    },
                    "coreSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "masterSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "webSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "poolsSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "tasksSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "formsSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "exmMasterSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "searchService": {
                        "SkuName": "Standard",
                        "Partitions": 1,
                        "Replicas": "[parameters('searchServiceReplicaCount')]"
                    },
                    "redisCache": {
                        "SkuName": "Standard",
                        "SkuFamily": "C",
                        "SkuCapacity": 1
                    },
                    "applicationInsightsPricePlan": {
                        "CurrentBillingFeatures": "Basic",
                        "DataVolumeCap": {
                            "Cap": 0.33
                        }
                    }
                },
                "Medium": {
                    "siHostingPlan": {
                        "SkuName": "S1",
                        "SkuCapacity": 1
                    },
                    "siHostingPlanIsolated": {
                        "SkuName": "I1",
                        "SkuCapacity": 1
                    },
                    "cmHostingPlan": {
                        "SkuName": "S3",
                        "SkuCapacity": 1
                    },
                    "cmHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "cdHostingPlan": {
                        "SkuName": "S2",
                        "SkuCapacity": 3
                    },
                    "cdHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 2
                    },
                    "prcHostingPlan": {
                        "SkuName": "S1",
                        "SkuCapacity": 1
                    },
                    "prcHostingPlanIsolated": {
                        "SkuName": "I1",
                        "SkuCapacity": 1
                    },
                    "repHostingPlan": {
                        "SkuName": "S2",
                        "SkuCapacity": 1
                    },
                    "repHostingPlanIsolated": {
                        "SkuName": "I1",
                        "SkuCapacity": 1
                    },
                    "coreSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "masterSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "webSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "poolsSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "tasksSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "formsSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "exmMasterSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "searchService": {
                        "SkuName": "Standard",
                        "Partitions": 2,
                        "Replicas": "[parameters('searchServiceReplicaCount')]"
                    },
                    "redisCache": {
                        "SkuName": "Standard",
                        "SkuFamily": "C",
                        "SkuCapacity": 1
                    },
                    "applicationInsightsPricePlan": {
                        "CurrentBillingFeatures": "Basic",
                        "DataVolumeCap": {
                            "Cap": 0.33
                        }
                    }
                },
                "Large": {
                    "siHostingPlan": {
                        "SkuName": "S2",
                        "SkuCapacity": 1
                    },
                    "siHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "cmHostingPlan": {
                        "SkuName": "S3",
                        "SkuCapacity": 1
                    },
                    "cmHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "cdHostingPlan": {
                        "SkuName": "S3",
                        "SkuCapacity": 4
                    },
                    "cdHostingPlanIsolated": {
                        "SkuName": "I3",
                        "SkuCapacity": 2
                    },
                    "prcHostingPlan": {
                        "SkuName": "S2",
                        "SkuCapacity": 1
                    },
                    "prcHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "repHostingPlan": {
                        "SkuName": "S2",
                        "SkuCapacity": 1
                    },
                    "repHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "coreSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "masterSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "webSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S2"
                    },
                    "poolsSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "tasksSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S0"
                    },
                    "formsSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "exmMasterSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "searchService": {
                        "SkuName": "Standard",
                        "Partitions": 3,
                        "Replicas": "[parameters('searchServiceReplicaCount')]"
                    },
                    "redisCache": {
                        "SkuName": "Standard",
                        "SkuFamily": "C",
                        "SkuCapacity": 1
                    },
                    "applicationInsightsPricePlan": {
                        "CurrentBillingFeatures": "Application Insights Enterprise",
                        "DataVolumeCap": {
                            "Cap": 1.8
                        }
                    }
                },
                "Extra Large": {
                    "siHostingPlan": {
                        "SkuName": "S2",
                        "SkuCapacity": 1
                    },
                    "siHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "cmHostingPlan": {
                        "SkuName": "S3",
                        "SkuCapacity": 1
                    },
                    "cmHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "cdHostingPlan": {
                        "SkuName": "S3",
                        "SkuCapacity": 8
                    },
                    "cdHostingPlanIsolated": {
                        "SkuName": "I3",
                        "SkuCapacity": 4
                    },
                    "prcHostingPlan": {
                        "SkuName": "S2",
                        "SkuCapacity": 1
                    },
                    "prcHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "repHostingPlan": {
                        "SkuName": "S2",
                        "SkuCapacity": 1
                    },
                    "repHostingPlanIsolated": {
                        "SkuName": "I2",
                        "SkuCapacity": 1
                    },
                    "coreSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "masterSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "webSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S3"
                    },
                    "poolsSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S2"
                    },
                    "tasksSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S1"
                    },
                    "formsSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S2"
                    },
                    "exmMasterSqlDatabase": {
                        "Edition": "Standard",
                        "MaxSize": "268435456000",
                        "ServiceObjectiveLevel": "S2"
                    },
                    "searchService": {
                        "SkuName": "Standard",
                        "Partitions": 3,
                        "Replicas": "[parameters('searchServiceReplicaCount')]"
                    },
                    "redisCache": {
                        "SkuName": "Standard",
                        "SkuFamily": "C",
                        "SkuCapacity": 2
                    },
                    "applicationInsightsPricePlan": {
                        "CurrentBillingFeatures": "Application Insights Enterprise",
                        "DataVolumeCap": {
                            "Cap": 1.8
                        }
                    }
                }
            },
            "type": "SecureObject"
        },
        "resourceSizes": {
            "defaultValue": "[parameters('skuMap')[parameters('sitecoreSKU')]]",
            "type": "Object"
        },
        "aseName": {
            "defaultValue": "",
            "type": "String"
        },
        "aseResourceGroupName": {
            "defaultValue": "[resourceGroup().name]",
            "type": "String"
        },
        "environment": {
            "defaultValue": "qa",
            "type": "String"
        },
        "team-pod": {
            "defaultValue": "direct-pod-6-apollo",
            "type": "String"
        },
        "platform": {
            "defaultValue": "direct",
            "type": "String"
        },
        "infra-app": {
            "defaultValue": "application",
            "type": "String"
        },
        "business-service": {
            "defaultValue": "direct-digital",
            "type": "String"
        },
        "data-classification": {
            "defaultValue": "no-data",
            "type": "String"
        },
        "application-service": {
            "defaultValue": "select-digital",
            "type": "String"
        }
    },
    "variables": {
        "webApiVersion": "2018-02-01",
        "serverFarmApiVersion": "2018-02-01",
        "dbApiVersion": "2014-04-01-preview",
        "searchApiVersion": "2015-08-19",
        "redisApiVersion": "2016-04-01",
        "appInsightsApiVersion": "2015-05-01",
        "certificateApiVersion": "2014-11-01",
        "sqlServerNameTidy": "[toLower(trim(parameters('sqlServerName')))]",
        "coreSqlDatabaseNameTidy": "[toLower(trim(parameters('coreSqlDatabaseName')))]",
        "webSqlDatabaseNameTidy": "[toLower(trim(parameters('webSqlDatabaseName')))]",
        "masterSqlDatabaseNameTidy": "[toLower(trim(parameters('masterSqlDatabaseName')))]",
        "poolsSqlDatabaseNameTidy": "[toLower(trim(parameters('poolsSqlDatabaseName')))]",
        "tasksSqlDatabaseNameTidy": "[toLower(trim(parameters('tasksSqlDatabaseName')))]",
        "formsSqlDatabaseNameTidy": "[toLower(trim(parameters('formsSqlDatabaseName')))]",
        "exmMasterSqlDatabaseNameTidy": "[toLower(trim(parameters('exmMasterSqlDatabaseName')))]",
        "siHostingPlanNameTidy": "[toLower(trim(parameters('siHostingPlanName')))]",
        "cmHostingPlanNameTidy": "[toLower(trim(parameters('cmHostingPlanName')))]",
        "cdHostingPlanNameTidy": "[toLower(trim(parameters('cdHostingPlanName')))]",
        "prcHostingPlanNameTidy": "[toLower(trim(parameters('prcHostingPlanName')))]",
        "repHostingPlanNameTidy": "[toLower(trim(parameters('repHostingPlanName')))]",
        "siWebAppNameTidy": "[toLower(trim(parameters('siWebAppName')))]",
        "cmWebAppNameTidy": "[toLower(trim(parameters('cmWebAppName')))]",
        "cdWebAppNameTidy": "[toLower(trim(parameters('cdWebAppName')))]",
        "prcWebAppNameTidy": "[toLower(trim(parameters('prcWebAppName')))]",
        "repWebAppNameTidy": "[toLower(trim(parameters('repWebAppName')))]",
        "searchServiceNameTidy": "[toLower(trim(parameters('searchServiceName')))]",
        "redisCacheNameTidy": "[toLower(trim(parameters('redisCacheName')))]",
        "appInsightsNameTidy": "[toLower(trim(parameters('applicationInsightsName')))]",
        "applicationInsightsPricePlanTidy": "[toLower(trim(parameters('applicationInsightsPricePlan')))]",
        "authCertificateNameTidy": "[toLower(trim(parameters('authCertificateName')))]",
        "sitecoreTags": {
            "provider": "b51535c2-ab3e-4a68-95f8-e2e3c9a19299",
            "si": "si",
            "cm": "cm",
            "cd": "cd",
            "rep": "rep",
            "prc": "prc",
            "core": "core",
            "master": "master",
            "web": "web",
            "pools": "prc-pools",
            "tasks": "prc-tasks",
            "forms": "forms",
            "exmmaster": "exmmaster",
            "redis": "redis",
            "azuresearch": "azuresearch",
            "sqlserver": "sqlserver",
            "ai": "ai"
        },
        "useAse": "[not(empty(parameters('aseName')))]",
        "aseResourceId": "[resourceId(parameters('aseResourceGroupName'), 'Microsoft.Web/hostingEnvironments', parameters('aseName'))]",
        "hostingPlanProperties": {
            "siProperties": {
                "name": "[variables('siHostingPlanNameTidy')]"
            },
            "siPropertiesWithASE": {
                "name": "[variables('siHostingPlanNameTidy')]",
                "hostingEnvironmentProfile": {
                    "id": "[variables('aseResourceId')]"
                }
            },
            "cmProperties": {
                "name": "[variables('cmHostingPlanNameTidy')]"
            },
            "cmPropertiesWithASE": {
                "name": "[variables('cmHostingPlanNameTidy')]",
                "hostingEnvironmentProfile": {
                    "id": "[variables('aseResourceId')]"
                }
            },
            "cdProperties": {
                "name": "[variables('cdHostingPlanNameTidy')]"
            },
            "cdPropertiesWithASE": {
                "name": "[variables('cdHostingPlanNameTidy')]",
                "hostingEnvironmentProfile": {
                    "id": "[variables('aseResourceId')]"
                }
            },
            "prcProperties": {
                "name": "[variables('prcHostingPlanNameTidy')]"
            },
            "prcPropertiesWithASE": {
                "name": "[variables('prcHostingPlanNameTidy')]",
                "hostingEnvironmentProfile": {
                    "id": "[variables('aseResourceId')]"
                }
            },
            "repProperties": {
                "name": "[variables('repHostingPlanNameTidy')]"
            },
            "repPropertiesWithASE": {
                "name": "[variables('repHostingPlanNameTidy')]",
                "hostingEnvironmentProfile": {
                    "id": "[variables('aseResourceId')]"
                }
            },
            "authCertificateHostingEnvironmentProfile": {
                "id": "[variables('aseResourceId')]"
            }
        }
    },
    "resources": [
        {
            "type": "Microsoft.Web/serverfarms",
            "apiVersion": "[variables('serverFarmApiVersion')]",
            "name": "[variables('siHostingPlanNameTidy')]",
            "location": "[parameters('location')]",
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').si]"
            },
            "sku": {
                "name": "[if(not(variables('useAse')), parameters('resourceSizes').siHostingPlan.SkuName, parameters('resourceSizes').siHostingPlanIsolated.SkuName)]",
                "capacity": "[if(not(variables('useAse')), parameters('resourceSizes').siHostingPlan.SkuCapacity, parameters('resourceSizes').siHostingPlanIsolated.SkuCapacity)]"
            },
            "properties": "[if(not(variables('useAse')), variables('hostingPlanProperties').siProperties, variables('hostingPlanProperties').siPropertiesWithASE)]"
        },
        {
            "type": "Microsoft.Web/serverfarms",
            "apiVersion": "[variables('serverFarmApiVersion')]",
            "name": "[variables('cmHostingPlanNameTidy')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', variables('siHostingPlanNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').cm]"
            },
            "sku": {
                "name": "[if(not(variables('useAse')), parameters('resourceSizes').cmHostingPlan.SkuName, parameters('resourceSizes').cmHostingPlanIsolated.SkuName)]",
                "capacity": "[if(not(variables('useAse')), parameters('resourceSizes').cmHostingPlan.SkuCapacity, parameters('resourceSizes').cmHostingPlanIsolated.SkuCapacity)]"
            },
            "properties": "[if(not(variables('useAse')), variables('hostingPlanProperties').cmProperties, variables('hostingPlanProperties').cmPropertiesWithASE)]"
        },
        {
            "type": "Microsoft.Web/serverfarms",
            "apiVersion": "[variables('serverFarmApiVersion')]",
            "name": "[variables('cdHostingPlanNameTidy')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', variables('cmHostingPlanNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').cd]"
            },
            "sku": {
                "name": "[if(not(variables('useAse')), parameters('resourceSizes').cdHostingPlan.SkuName, parameters('resourceSizes').cdHostingPlanIsolated.SkuName)]",
                "capacity": "[if(not(variables('useAse')), parameters('resourceSizes').cdHostingPlan.SkuCapacity, parameters('resourceSizes').cdHostingPlanIsolated.SkuCapacity)]"
            },
            "properties": "[if(not(variables('useAse')), variables('hostingPlanProperties').cdProperties, variables('hostingPlanProperties').cdPropertiesWithASE)]"
        },
        {
            "type": "Microsoft.Web/serverfarms",
            "apiVersion": "[variables('serverFarmApiVersion')]",
            "name": "[variables('prcHostingPlanNameTidy')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', variables('cdHostingPlanNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').prc]"
            },
            "sku": {
                "name": "[if(not(variables('useAse')), parameters('resourceSizes').prcHostingPlan.SkuName, parameters('resourceSizes').prcHostingPlanIsolated.SkuName)]",
                "capacity": "[if(not(variables('useAse')), parameters('resourceSizes').prcHostingPlan.SkuCapacity, parameters('resourceSizes').prcHostingPlanIsolated.SkuCapacity)]"
            },
            "properties": "[if(not(variables('useAse')), variables('hostingPlanProperties').prcProperties, variables('hostingPlanProperties').prcPropertiesWithASE)]"
        },
        {
            "type": "Microsoft.Web/serverfarms",
            "apiVersion": "[variables('serverFarmApiVersion')]",
            "name": "[variables('repHostingPlanNameTidy')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', variables('prcHostingPlanNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').rep]"
            },
            "sku": {
                "name": "[if(not(variables('useAse')), parameters('resourceSizes').repHostingPlan.SkuName, parameters('resourceSizes').repHostingPlanIsolated.SkuName)]",
                "capacity": "[if(not(variables('useAse')), parameters('resourceSizes').repHostingPlan.SkuCapacity, parameters('resourceSizes').repHostingPlanIsolated.SkuCapacity)]"
            },
            "properties": "[if(not(variables('useAse')), variables('hostingPlanProperties').repProperties, variables('hostingPlanProperties').repPropertiesWithASE)]"
        },
        {
            "type": "Microsoft.Web/sites",
            "apiVersion": "[variables('webApiVersion')]",
            "name": "[variables('siWebAppNameTidy')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', variables('siHostingPlanNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').si]"
            },
            "properties": {
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', variables('siHostingPlanNameTidy'))]",
                "siteConfig": {
                    "use32BitWorkerProcess": false,
                    "alwaysOn": true,
                    "phpVersion": "",
                    "defaultDocuments": [
                        "index.html"
                    ],
                    "metadata": [
                        {
                            "name": "CURRENT_STACK",
                            "value": "dotnetcore"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.Web/sites",
            "apiVersion": "[variables('webApiVersion')]",
            "name": "[variables('cmWebAppNameTidy')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', variables('cmHostingPlanNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').cm]"
            },
            "properties": {
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', variables('cmHostingPlanNameTidy'))]",
                "siteConfig": {
                    "use32BitWorkerProcess": false,
                    "alwaysOn": true,
                    "phpVersion": "",
                    "defaultDocuments": [
                        "index.html"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.Web/sites",
            "apiVersion": "[variables('webApiVersion')]",
            "name": "[variables('cdWebAppNameTidy')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', variables('cdHostingPlanNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').cd]"
            },
            "properties": {
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', variables('cdHostingPlanNameTidy'))]",
                "siteConfig": {
                    "use32BitWorkerProcess": false,
                    "alwaysOn": true,
                    "phpVersion": "",
                    "defaultDocuments": [
                        "index.html"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.Web/sites",
            "apiVersion": "[variables('webApiVersion')]",
            "name": "[variables('prcWebAppNameTidy')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', variables('prcHostingPlanNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').prc]"
            },
            "properties": {
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', variables('prcHostingPlanNameTidy'))]",
                "siteConfig": {
                    "use32BitWorkerProcess": false,
                    "alwaysOn": true,
                    "phpVersion": "",
                    "defaultDocuments": [
                        "index.html"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.Web/sites",
            "apiVersion": "[variables('webApiVersion')]",
            "name": "[variables('repWebAppNameTidy')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', variables('repHostingPlanNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').rep]"
            },
            "properties": {
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', variables('repHostingPlanNameTidy'))]",
                "siteConfig": {
                    "use32BitWorkerProcess": false,
                    "alwaysOn": true,
                    "phpVersion": "",
                    "defaultDocuments": [
                        "index.html"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.Sql/servers",
            "apiVersion": "[variables('dbApiVersion')]",
            "name": "[variables('sqlServerNameTidy')]",
            "location": "[parameters('location')]",
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').sqlserver]"
            },
            "properties": {
                "administratorLogin": "[parameters('sqlServerLogin')]",
                "administratorLoginPassword": "[parameters('sqlServerPassword')]",
                "version": "[parameters('sqlServerVersion')]"
            },
            "resources": [
                {
                    "type": "firewallrules",
                    "apiVersion": "[variables('dbApiVersion')]",
                    "name": "AllowAllAzureIps",
                    "dependsOn": [
                        "[resourceId('Microsoft.Sql/servers', variables('sqlServerNameTidy'))]"
                    ],
                    "properties": {
                        "endIpAddress": "0.0.0.0",
                        "startIpAddress": "0.0.0.0"
                    }
                },
                {
                    "type": "databases",
                    "apiVersion": "[variables('dbApiVersion')]",
                    "name": "[variables('coreSqlDatabaseNameTidy')]",
                    "location": "[parameters('location')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.Sql/servers', variables('sqlServerNameTidy'))]"
                    ],
                    "tags": {
                        "environment": "[parameters('environment')]",
                        "team-pod": "[parameters('team-pod')]",
                        "platform": "[parameters('platform')]",
                        "infra-app": "[parameters('infra-app')]",
                        "business-service": "[parameters('business-service')]",
                        "data-classification": "[parameters('data-classification')]",
                        "application-service": "[parameters('application-service')]",
                        "logicalName": "[variables('sitecoreTags').core]"
                    },
                    "properties": {
                        "edition": "[parameters('resourceSizes').coreSqlDatabase.Edition]",
                        "collation": "[parameters('sqlDatabaseCollation')]",
                        "maxSizeBytes": "[parameters('resourceSizes').coreSqlDatabase.MaxSize]",
                        "requestedServiceObjectiveName": "[parameters('resourceSizes').coreSqlDatabase.ServiceObjectiveLevel]"
                    },
                    "resources": [
                        {
                            "type": "transparentDataEncryption",
                            "apiVersion": "2014-04-01",
                            "name": "current",
                            "dependsOn": [
                                "[variables('coreSqlDatabaseNameTidy')]"
                            ],
                            "properties": {
                                "status": "Enabled"
                            }
                        }
                    ]
                },
                {
                    "type": "databases",
                    "apiVersion": "[variables('dbApiVersion')]",
                    "name": "[variables('masterSqlDatabaseNameTidy')]",
                    "location": "[parameters('location')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.Sql/servers', variables('sqlServerNameTidy'))]"
                    ],
                    "tags": {
                        "environment": "[parameters('environment')]",
                        "team-pod": "[parameters('team-pod')]",
                        "platform": "[parameters('platform')]",
                        "infra-app": "[parameters('infra-app')]",
                        "business-service": "[parameters('business-service')]",
                        "data-classification": "[parameters('data-classification')]",
                        "application-service": "[parameters('application-service')]",
                        "logicalName": "[variables('sitecoreTags').master]"
                    },
                    "properties": {
                        "edition": "[parameters('resourceSizes').masterSqlDatabase.Edition]",
                        "collation": "[parameters('sqlDatabaseCollation')]",
                        "maxSizeBytes": "[parameters('resourceSizes').masterSqlDatabase.MaxSize]",
                        "requestedServiceObjectiveName": "[parameters('resourceSizes').masterSqlDatabase.ServiceObjectiveLevel]"
                    },
                    "resources": [
                        {
                            "type": "transparentDataEncryption",
                            "apiVersion": "2014-04-01",
                            "name": "current",
                            "dependsOn": [
                                "[variables('masterSqlDatabaseNameTidy')]"
                            ],
                            "properties": {
                                "status": "Enabled"
                            }
                        }
                    ]
                },
                {
                    "type": "databases",
                    "apiVersion": "[variables('dbApiVersion')]",
                    "name": "[variables('webSqlDatabaseNameTidy')]",
                    "location": "[parameters('location')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.Sql/servers', variables('sqlServerNameTidy'))]"
                    ],
                    "tags": {
                        "environment": "[parameters('environment')]",
                        "team-pod": "[parameters('team-pod')]",
                        "platform": "[parameters('platform')]",
                        "infra-app": "[parameters('infra-app')]",
                        "business-service": "[parameters('business-service')]",
                        "data-classification": "[parameters('data-classification')]",
                        "application-service": "[parameters('application-service')]",
                        "logicalName": "[variables('sitecoreTags').web]"
                    },
                    "properties": {
                        "edition": "[parameters('resourceSizes').webSqlDatabase.Edition]",
                        "collation": "[parameters('sqlDatabaseCollation')]",
                        "maxSizeBytes": "[parameters('resourceSizes').webSqlDatabase.MaxSize]",
                        "requestedServiceObjectiveName": "[parameters('resourceSizes').webSqlDatabase.ServiceObjectiveLevel]"
                    },
                    "resources": [
                        {
                            "type": "transparentDataEncryption",
                            "apiVersion": "2014-04-01",
                            "name": "current",
                            "dependsOn": [
                                "[variables('webSqlDatabaseNameTidy')]"
                            ],
                            "properties": {
                                "status": "Enabled"
                            }
                        }
                    ]
                },
                {
                    "type": "databases",
                    "apiVersion": "[variables('dbApiVersion')]",
                    "name": "[variables('poolsSqlDatabaseNameTidy')]",
                    "location": "[parameters('location')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.Sql/servers', variables('sqlServerNameTidy'))]"
                    ],
                    "tags": {
                        "environment": "[parameters('environment')]",
                        "team-pod": "[parameters('team-pod')]",
                        "platform": "[parameters('platform')]",
                        "infra-app": "[parameters('infra-app')]",
                        "business-service": "[parameters('business-service')]",
                        "data-classification": "[parameters('data-classification')]",
                        "application-service": "[parameters('application-service')]",
                        "logicalName": "[variables('sitecoreTags').pools]"
                    },
                    "properties": {
                        "edition": "[parameters('resourceSizes').poolsSqlDatabase.Edition]",
                        "collation": "[parameters('sqlDatabaseCollation')]",
                        "maxSizeBytes": "[parameters('resourceSizes').poolsSqlDatabase.MaxSize]",
                        "requestedServiceObjectiveName": "[parameters('resourceSizes').poolsSqlDatabase.ServiceObjectiveLevel]"
                    },
                    "resources": [
                        {
                            "type": "transparentDataEncryption",
                            "apiVersion": "2014-04-01",
                            "name": "current",
                            "dependsOn": [
                                "[variables('poolsSqlDatabaseNameTidy')]"
                            ],
                            "properties": {
                                "status": "Enabled"
                            }
                        }
                    ]
                },
                {
                    "type": "databases",
                    "apiVersion": "[variables('dbApiVersion')]",
                    "name": "[variables('tasksSqlDatabaseNameTidy')]",
                    "location": "[parameters('location')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.Sql/servers', variables('sqlServerNameTidy'))]"
                    ],
                    "tags": {
                        "environment": "[parameters('environment')]",
                        "team-pod": "[parameters('team-pod')]",
                        "platform": "[parameters('platform')]",
                        "infra-app": "[parameters('infra-app')]",
                        "business-service": "[parameters('business-service')]",
                        "data-classification": "[parameters('data-classification')]",
                        "application-service": "[parameters('application-service')]",
                        "logicalName": "[variables('sitecoreTags').tasks]"
                    },
                    "properties": {
                        "edition": "[parameters('resourceSizes').tasksSqlDatabase.Edition]",
                        "collation": "[parameters('sqlDatabaseCollation')]",
                        "maxSizeBytes": "[parameters('resourceSizes').tasksSqlDatabase.MaxSize]",
                        "requestedServiceObjectiveName": "[parameters('resourceSizes').tasksSqlDatabase.ServiceObjectiveLevel]"
                    },
                    "resources": [
                        {
                            "type": "transparentDataEncryption",
                            "apiVersion": "2014-04-01",
                            "name": "current",
                            "dependsOn": [
                                "[variables('tasksSqlDatabaseNameTidy')]"
                            ],
                            "properties": {
                                "status": "Enabled"
                            }
                        }
                    ]
                },
                {
                    "type": "databases",
                    "apiVersion": "[variables('dbApiVersion')]",
                    "name": "[variables('formsSqlDatabaseNameTidy')]",
                    "location": "[parameters('location')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.Sql/servers', variables('sqlServerNameTidy'))]"
                    ],
                    "tags": {
                        "environment": "[parameters('environment')]",
                        "team-pod": "[parameters('team-pod')]",
                        "platform": "[parameters('platform')]",
                        "infra-app": "[parameters('infra-app')]",
                        "business-service": "[parameters('business-service')]",
                        "data-classification": "[parameters('data-classification')]",
                        "application-service": "[parameters('application-service')]",
                        "logicalName": "[variables('sitecoreTags').forms]"
                    },
                    "properties": {
                        "edition": "[parameters('resourceSizes').formsSqlDatabase.Edition]",
                        "collation": "[parameters('sqlDatabaseCollation')]",
                        "maxSizeBytes": "[parameters('resourceSizes').formsSqlDatabase.MaxSize]",
                        "requestedServiceObjectiveName": "[parameters('resourceSizes').formsSqlDatabase.ServiceObjectiveLevel]"
                    },
                    "resources": [
                        {
                            "type": "transparentDataEncryption",
                            "apiVersion": "2014-04-01",
                            "name": "current",
                            "dependsOn": [
                                "[variables('formsSqlDatabaseNameTidy')]"
                            ],
                            "properties": {
                                "status": "Enabled"
                            }
                        }
                    ]
                },
                {
                    "type": "databases",
                    "apiVersion": "[variables('dbApiVersion')]",
                    "name": "[variables('exmMasterSqlDatabaseNameTidy')]",
                    "location": "[parameters('location')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.Sql/servers', variables('sqlServerNameTidy'))]"
                    ],
                    "tags": {
                        "environment": "[parameters('environment')]",
                        "team-pod": "[parameters('team-pod')]",
                        "platform": "[parameters('platform')]",
                        "infra-app": "[parameters('infra-app')]",
                        "business-service": "[parameters('business-service')]",
                        "data-classification": "[parameters('data-classification')]",
                        "application-service": "[parameters('application-service')]",
                        "logicalName": "[variables('sitecoreTags').exmmaster]"
                    },
                    "properties": {
                        "edition": "[parameters('resourceSizes').exmMasterSqlDatabase.Edition]",
                        "collation": "[parameters('sqlDatabaseCollation')]",
                        "maxSizeBytes": "[parameters('resourceSizes').exmMasterSqlDatabase.MaxSize]",
                        "requestedServiceObjectiveName": "[parameters('resourceSizes').exmMasterSqlDatabase.ServiceObjectiveLevel]"
                    },
                    "resources": [
                        {
                            "type": "transparentDataEncryption",
                            "apiVersion": "2014-04-01",
                            "name": "current",
                            "dependsOn": [
                                "[variables('exmMasterSqlDatabaseNameTidy')]"
                            ],
                            "properties": {
                                "status": "Enabled"
                            }
                        }
                    ]
                }
            ]
        },
        {
            "type": "Microsoft.Search/searchServices",
            "apiVersion": "[variables('searchApiVersion')]",
            "name": "[variables('searchServiceNameTidy')]",
            "location": "[if(parameters('deployAzureSearch'), parameters('searchServiceLocation'), 'westus')]",
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').azuresearch]"
            },
            "sku": {
                "name": "[toLower(parameters('resourceSizes').searchService.SkuName)]"
            },
            "properties": {
                "replicaCount": "[parameters('resourceSizes').searchService.Replicas]",
                "partitionCount": "[parameters('resourceSizes').searchService.Partitions]"
            },
            "condition": "[parameters('deployAzureSearch')]"
        },
        {
            "type": "Microsoft.Cache/Redis",
            "apiVersion": "[variables('redisApiVersion')]",
            "name": "[variables('redisCacheNameTidy')]",
            "location": "[parameters('location')]",
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').redis]"
            },
            "properties": {
                "sku": {
                    "name": "[parameters('resourceSizes').redisCache.SkuName]",
                    "family": "[parameters('resourceSizes').redisCache.SkuFamily]",
                    "capacity": "[parameters('resourceSizes').redisCache.SkuCapacity]"
                },
                "enableNonSslPort": false
            }
        },
        {
            "type": "Microsoft.Insights/Components",
            "apiVersion": "[variables('appInsightsApiVersion')]",
            "name": "[variables('appInsightsNameTidy')]",
            "location": "[parameters('applicationInsightsLocation')]",
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]",
                "logicalName": "[variables('sitecoreTags').ai]"
            },
            "properties": {
                "ApplicationId": "[variables('appInsightsNameTidy')]",
                "Application_Type": "web"
            },
            "condition": "[parameters('useApplicationInsights')]"
        },
        {
            "type": "Microsoft.Insights/Components/CurrentBillingFeatures",
            "apiVersion": "[variables('appInsightsApiVersion')]",
            "name": "[concat(variables('appInsightsNameTidy'), '/', variables('applicationInsightsPricePlanTidy'))]",
            "location": "[parameters('applicationInsightsLocation')]",
            "dependsOn": [
                "[resourceId('Microsoft.Insights/Components', variables('appInsightsNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]"
            },
            "properties": {
                "CurrentBillingFeatures": "[parameters('resourceSizes').applicationInsightsPricePlan.CurrentBillingFeatures]",
                "DataVolumeCap": {
                    "Cap": "[parameters('resourceSizes').applicationInsightsPricePlan.DataVolumeCap.Cap]"
                }
            },
            "condition": "[parameters('useApplicationInsights')]"
        },
        {
            "type": "Microsoft.Web/certificates",
            "apiVersion": "[variables('certificateApiVersion')]",
            "name": "[variables('authCertificateNameTidy')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', variables('siHostingPlanNameTidy'))]",
                "[resourceId('Microsoft.Web/serverfarms', variables('cmHostingPlanNameTidy'))]",
                "[resourceId('Microsoft.Web/serverfarms', variables('cdHostingPlanNameTidy'))]",
                "[resourceId('Microsoft.Web/serverfarms', variables('prcHostingPlanNameTidy'))]",
                "[resourceId('Microsoft.Web/serverfarms', variables('repHostingPlanNameTidy'))]"
            ],
            "tags": {
                "environment": "[parameters('environment')]",
                "team-pod": "[parameters('team-pod')]",
                "platform": "[parameters('platform')]",
                "infra-app": "[parameters('infra-app')]",
                "business-service": "[parameters('business-service')]",
                "data-classification": "[parameters('data-classification')]",
                "application-service": "[parameters('application-service')]"
            },
            "properties": {
                "password": "[parameters('authCertificatePassword')]",
                "pfxBlob": "[parameters('authCertificateBlob')]",
                "hostingEnvironmentProfile": "[if(variables('useAse'), variables('hostingPlanProperties').authCertificateHostingEnvironmentProfile, '')]"
            }
        }
    ],
    "outputs": {
        "infrastructure": {
            "type": "Object",
            "value": {
                "sqlServerFqdn": "[reference(concat('Microsoft.Sql/servers/', variables('sqlServerNameTidy'))).fullyQualifiedDomainName]",
                "siWebAppHostName": "[reference(concat('Microsoft.Web/sites/', variables('siWebAppNameTidy')), variables('webApiVersion')).defaultHostName]",
                "cmWebAppHostName": "[reference(concat('Microsoft.Web/sites/', variables('cmWebAppNameTidy')), variables('webApiVersion')).defaultHostName]",
                "authCertificateThumbprint": "[reference(resourceId('Microsoft.Web/certificates', variables('authCertificateNameTidy'))).thumbprint]"
            }
        }
    }
}